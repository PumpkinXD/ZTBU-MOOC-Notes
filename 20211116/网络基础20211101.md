3.2 OSI参考模型

3.2.3 网络层

数据链路层仅提供点对点的数据链路，不能直接提供用户数据的端到端之间的传输，也就无法解决经过通信子网中多个转接结点的通信问题。网络层的传输单位是分组或包（Packet），网络层能够读取包协议地址信息并将每一个包沿最佳路径转发直至到达目的结点。
网络层允许分组通过路由从一个网络发送到另一个网络，而用户不必关心网络的拓扑结构和所使用的通信介质。也就是说，网络层可以用于为两个不同网络或网段之间的计算机建立通信。

1.网络层的功能



1）路由选择

网络层的关键问题是如何进行路由选择，以确定数据分组如何到达目的结点。通信子网中的路径是指从源结点到目的结点之间的一条通路，一般在两个结点之间都会有多条路径供选择。路由是指在通信子网中，源节点和中间结点将报文分组传送到目的结点而对后继结点进行选择的过程。为确定最佳路由，网络层需要持续地收集有关各个网络和结点地址的信息。

2）流量控制

网络中多个层次都存在流量控制问题，网络层的流量控制则通过限制用户一次性提交给网络的分组个数对进入分组交换网的通信量进行控制，以防因通信量过大而造成通信子网性能下降

3）多用户数据传输（信道复用）

为了在一条数据链路（Data Link，DL）上交织地传输多个用户的数据，可将一条DL划分为若干条逻辑电路，称为逻辑信道（Logic Circuit，LC）。利用每条LC支持一对用户的数据传输，并且利用LC号来区分不同用户的数据。

2.网络层提供的服务

从OSI的角度看，网络层所提供的服务可分为两类：面向连接的网络服务和无连接网络服务。





1）面向连接的网络服务（可靠）

面向连接的网络服务又称为虚电路（Virtual Circuit）服务，它具有网络连接建立、数据传输和网络连接释放三个阶段，是可靠的报文分组按顺序传输的方式，适用于确定型对象、长报文、会话型传输要求。
虚电路技术的主要特点是，在数据传送以前必须在源结点和目的结点之间建立一条虚电路。值得注意的是，虚电路的概念不同于前面电路交换技术中电路的概念。后者对应着一条实实在在的物理线路，是通信双方的物理连接。而虚电路是指在通信双方之间建立了一条逻辑连接，不独占信道带宽，数据沿逻辑连接路径以存储转发方式传输。
网络层沿着多个虚电路传输数据，那么数据到达时就有可能出现错误的顺序。因此网络层在将包传输给下一层前应检查数据的顺序，如有必要就对其进行改正。

2）无连接网络服务（不可靠）

不需要通信双方事先建立好一个连接

有三种类型：数据报（Datagram）、确认交付（Confirm Delivery）、与请求回答（Request Reply）。

数据报服务不要求接收端应答，这种方法额外开销较小，但可靠性无法保证；确认交付服务要求接收端用户每收到一个报文均给发送端用户发送回一个应答报文；请求回答类似于一次事务处理中用户的“一问一答”。
虚电路方式与数据报方式之间的最大差别在于：虚电路方式为每一对结点之间的通信预先建立一条虚电路，后续的数据通信沿着建立好的虚电路进行，路由器不必为每个报文进行路由选择。而在数据报方式中，路由器为每一个进入的报文进行一次路由选择，也就是说，每个报文的路由选择独立于其他报文。

3.2.4 传输层

传输层位于OSI的第四层，它是网络中资源子网与通信子网的桥梁，主要负责确保数据可靠、顺序、无差错地从A点传输到B点（A，B可能位于相同或不同的网络）。如果没有传输层，数据将不能被接受端验证或解释。

传输层的功能是在网络层提供服务的基础上建立的，其任务是向用户提供可靠的，透明的、端到端的数据传输，采用一些技术手段弥补用户对不同网络的要求以及网络可向用户提供的服务之间的差异，使得用户无需了解网络传输的细节，就能获得相对稳定的数据传输服务。传输层采用的技术手段主要有以下几种：

1）分流/合流技术

是利用多条网络连接来支持一条运输连接上的数据传输，目的是使低吞吐量、地速率和高传输延迟的网络可以支持用户高速传输数据的要求

2）复用/解引用技术

是将多条运输连接上的数据汇集到一条网络连接上传输，使具有高吞吐量、高速率和低传输延迟且高费用的网络可以支持用户的低传输成本的要求。

3）分段/合段技术

是将一个长的运输服务数据单元分成若干个运输协议数据单元进行传输，使传输长度有限的网络可以支持用户的无限长度数据的传输。

4）差错检测和恢复技术

使差错率较高的网络可以支持用户高可靠性的数据传输要求。

5）流量控制技术

对连续传输的协议单元个数进行限制，避免网络拥塞。

传输层传输信息的基本单位是报文Message。传输层提供的服务包括标识和维护运输连接（建立与释放连接，以及选择服务质量），提供流量控制，差错检查与恢复，常规数据/加速数据的传输等。

3.2.5 会话层

传输层可以保证用户数据按照要求从网络的一端传输到另一端，但在用户（未记完）

1。会话层的功能

向会话的应用进程之间提供会话组织和同步服务，对数据的传送提供控制和管理，以协调会话过程，伟表示层实体提供更好的服务。具体分为四个方面：

（1）利用令牌技术来保证数据交换、会话同步的有序性，拥有令牌的一方可以发送数据或执行其他动作。



（2）利用活动和同步技术来保证用户数据的完整性，并让用户知道整个交换的过程。

（3）利用分段和拼接技术来提高数据交换的效率，多块用户数据可以合并在一起进行传输。

（4）利用重新同步技术来实现用户会话的延续性，支持传输过程中的故障恢复。

3.2.6 表示层

计算机联网的最终目的是实现用户之间的数据交换。但是，由于不同的计算机系统可能采用不同的信息编码，或者具有不同的信息描述和表示方法，如果不加以处理，不同的信息描述（表示）将导致通信的计算机系统之间无法正确地识别信息。

表示层的目的就是屏蔽不同计算机在信息表示方面的差异，其功能包括传送语法的协商，以及抽象语法和传送语法之间的转换。通信双方在建立通信关系后，首先要进行协商，协商内容包括采用什么数据编码进行传输，传输过程中数据是否要压缩，采用什么压缩算法等。协商结束后选择一种双方都能处理的数据表示方式进行通信。

3.2.7应用层（OSI的顶端）

为网络用户和应用程序提供各种服务

常见的协议有FTP，HTTP，SNMP

3.2.8 OSI中的数据传输

在网络通信传输中，为了确保数据能够被顺利、准确地传送到目的地，需要OSI各层对数据的对数据进行相应的处理，以主机A向主机B传输数据为例（图先欠着），数据在通过A各层时，每层都会为上层传来的数据加上一个信息头或尾（作为主机B的对等层处理数据的依据）然后向下层发送，这个过程可以理解为各层对数据的封装。

当经过层层封装的数据最终通过传输介质传输到主机B后，主机B的每一层再对数据进行相应的处理（自下而上），把信息头或尾去掉，最后还原成实际的数据，即执行主机A的逆过程，这个过程可以理解为对数据的拆封或解封。

在物理上，数据在发送端主机各层中是从上向下封装，最后通过传输介质到达对方主机，再在接收端主机各层中从下向上解封；但是在逻辑上，发送端和接收端每一层只负责处理每一层的事情，并不需要关心其他层的具体的事情。

下面通过发送和接收电子邮件的例子，说明在OSI参考模型中传输数据的具体过程。

（1）在某台电脑上写好电子邮件后，提出发送邮件到远程邮件服务器的请求，应用层会识别该请求，并将请求传输到表示层。
（2）表示层判断是否要对数据格式进行转换及如何转换等，然后在数据中加入相应的代码信息，并将请求传递到会话层。
（3）会话层接收到表示层发过来的请求后，给该请求添加一个数据标记符，指示用户有权限传输数据（即可以建立会话），然后将数据传输到传输层。

（4）在传输层，数据被分割成若干数据段，并在每个数据段的头部加上TCP报头（包含源端和目标端的端口号，以实现端到端的连接和通信），然后将封装好的数据传输到网络层。在传输层中封装好的数据被称为报文（Message）。
（5）网络层为数据添加逻辑地址信息，即在TCP报头前添加IP报头（包含数据包的原逻辑地址和目标逻辑地址），这时我们称该数据为数据包或分组（Packet）。
（6）数据包达到数据链路层后，先进入LLC子层加上LLC头部，然后进入MAC子层加上MAC头部和一个FCS尾部。数据包在数据链路层中会被封装成帧。
（7）数据帧被传输到物理层后，物理层不添加任何信息，把数据帧发送到传输介质并以比特流的形式传输。
（8）当数据达到另一端服务器的物理层时，反向执行上述过程。
