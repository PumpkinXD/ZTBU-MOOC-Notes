4.2 网际互联协议IP
5 可变长子网划分

当用户选择了一个普通子网掩码之后，就不能支持不同尺寸的子网了，这对于网络内部不同网段需要不同大小子网的情形来说非常不方便。相对于普通子网掩码，在RFC 1878中定义了可变长子网掩码（Variable Length Subnet Mask，VLSM），它在划分子网并保留足够主机数的同时，将子网进一步分成多个小子网，这种方法能将网络划分为三级或更多级子网，使子网划分具有更大的灵活性，也使IP地址具有更高的利用率。
如果对一个网络进行了可变长子网划分，那么就可以用不同长度的子网网络号来唯一标识每个子网，并能通过对应的子网掩码进行区分。VLSM规定了如何在一个进行了子网划分的网络中的不同部分使用不同的子网掩码。

4.4.1 IPV6

现在使用的IPv4采用32位地址长度，只有大约43亿个地址，估计在未来的若干年间将被分配完毕。1990年，因特网工程任务组（IETF）开始启动IP新版本的设计工作。经过多次讨论、修订和定位之后，在1993年得到了一个名为SIPP（Simple Internet Protocol Plus）的协议，即IPv6（网际协议第6版）。

特点

1、扩大了地址空间

IP地址的长度从4个字节（32bits）扩充为16个字节（128bits），理论上能够提供3.4×1038个地址。采用IPv6技术后，未来的移动电话、冰箱等信息家电设备都可以拥有一个唯一的IP地址。

2、地址层次丰富、分配合理

IPv6的管理机构将某一确定的TLA(顶级集聚标识符，是选路分级结构中的最高级)分配给某些骨干网的ISP，然后骨干网的ISP再灵活地为各个中小ISP分配NLA(为TLA的下一级集聚标识符，用来创建寻址分级结构和标识站点)，而终端用户可从中、小ISP获得IP地址。

3、增加了安全认证机制

为了防止机密被窃,系统不能向未被批准的用户显示任何数据；
为了使数据不被破坏，系统不允许未经批准而随意更改数据；
为了确保服务质量,系统不允许任意改变用户的级别。

4、提高了路由器的转发效率

IPv6规定，仅由源端系统进行数据的分段，途经的所有路由器不必再对数据进行分段提高了路由器的工作效率。

5、增强了协议的可扩充性

IPv6是几乎能够无限制地增加IP网址数量、拥有巨大网址空间和卓越网络安全性能等特点的新一代互联网协议。

6、无状态自动配置

IPv6通过邻居发现机制能为主机自动配置接口地址和缺省路由器信息，使得从互联网到终端用户之间的连接不经过用户干预就能够快速建立起来。



4.4.2  IPv6对IPV4的兼容

全球有难以计数的计算机正在使用IPv4，这使IPv4到IPv6的转变不可能在短期内完成。因此，IPv4和IPv6必须在相当长一段时间内共存。IPv6对IPv4的兼容至关重要。为了解决这些问题，IPv6地址结构允许覆盖IPv4的地址类型。由于IPv6地址比IPv4地址长，存放IPv4地址不成问题，难的是如何使两种协议同时工作。

1.IPv6地址

IPv4地址以“.”分隔的十进制格式表示，32位地址每8位一组，再将每组的8位转换成等价的十进制数，并用“.”分隔。
而对于IPv6，128位地址每16位组，再将每个16位块转换成4位十六进制数字,每组间用“：”分隔，结果用冒分十六进制格式表示。

1）IPv6地址的压缩表示

用128位来表示地址，地址中会含有较多的一系列的0，将每个块中的前导零(开头的零)删除，就成为IPv6地址的压缩表示。
地址：             21DA:00D3:0000:2F3B:02AA:00FF:FE28:9C5A
压缩表示为： 2IDA: D3: 0: 2F3B: 2AA: FF: FE28：9C5A。
十六进制数格式中被设置为0的连续16位信息块可以被压缩为::(即双冒号)。
如EF70:0:0:0:2AA:FF:FE9A:4CA2可以被压缩为EF70::2AA:FF:FE9A:4CA2。



要确定::表示多少个0位,可以数一下压缩地址中的块数,用8减去块数后乘以16就得到0的位数。如地址FF02::2中有两个块(FF02和2),那么用“：：”表示的位数是96(96=(8-2)×16)。注意零压缩只能在给定地址中使用一次,否则就不能确定每个双冒号(::)实际表示的0位的数量。

2） IPv6的前缀

​       IPv6前缀是地址的一部分，指出有固定值的地址位，或者属于网络标识的地址位。IPv6路由和子网标识的前缀，与IPv4的域内无级路由选择法(CIDR)的表达方式一样。IPv6前缀用“地址/前缀长度”表示法表示。如21DA:D3::/48是路由前缀，而21DA:D3:0:2F3B::/64是子网前缀。



在某些情况下，IPv4地址需要包含在IPv6地址中，这时，最后两组用现在习惯使用的IPv4的十进制表示方法，前六组表示方法同上，例如，IPv4地址61.1.133.1包含在IPv6地址中时表示为0:0:0:0:0:0:61.1.133.1，或者是：：61.1.133.1。



3）IPv6地址的结构

128位的IPv6地址由64位网络地址和64位主机地址组成。其中，64位的网络地址又分为48位的全球网络标识符和16位的本地子网标识符

前48bits： Global ID 全球标识符

中16bits：Subnet ID 本地子网标识符

后64bits：Interface ID 节点（主机）标识符

4）IPv6地址空间

​        IPv6的最大特征就是采用了128位的地址空间,是IPv4的4倍。IPv6在设计分层寻址和路由时能提供多个等级的层次和灵活性,这一点正好是目前基于IPv4的Internet所缺乏的。与IPv4地址空间的划分方法类似,也是根据地址中高位比特来划分IPv6地址空间。

（表以后补充）

3 IPv4到IPv6的过渡技术

如何完成从IPv4到IPv6的转换，是IPv6发展中需要解决的首要问题。目前，IETF已经成立了专门的工作组研究IPv4到IPv6的转换，并且提出了很多方案，主要包括以下几个类型。

1）IPv6地址的结构

隧道技术：路由器将IPv6的数据分组封装入IPv4，IPv4分组的源地址和目的地址分别是隧道入口和出口的IPv4地址。当分组到达隧道的出口处，再将IPv6分组取出转发给目的站点。利用隧道技术，可以通过运行IPv4协议的Internet骨干网络（即隧道）将局部的IPv6网络连接起来，因而是IPv4向IPv6过渡的初期最易于采用的技术。

2）主机过渡技术

IPv6和IPv4是功能相近的网络层协议，两者都基于相同的物理平台，而且加载于其上的传输层协议TCP和UDP又没有任何区别。可以看出，如果一台主机同时支持IPv6和IPv4两种协议，那么该主机既能与支持IPv4的主机通信，又能与支持IPv6的主机通信，这就是双协议栈技术的工作机理。

3）应用服务系统过渡技术

在IPv4到IPv6的过渡过程中，作为Internet基础架构的应用服务系统DNS也要支持这种网络协议的升级和转换。IPv4和IPv6的DNS在记录格式等方面有所不同。为了实现IPv4网络和IPv6网络之间的DNS查询和响应，可以采用应用层网关DNS-ALG结合NAT-PT的方法，在IPv4和IPv6网络之间起到一个翻译的作用。