4.3  网络寻址路由器

1 路由器

路由器的功能：
在局域网中用来互联各个子网，同时隔离广播和介质访问冲突。
路由器将一个大网络分成若干个子网，以保证子网内通讯流量的局域性，屏蔽其它子网无关的流量，进而更有效地利用带宽。对于那些需要前往其它子网和离开整个网络前往其它网络的流量，路由器提供必要的数据转发。

2 路由器的工作原理

从图中可以看见，路由器的各个端口也需要有IP地址和物理地址。路由器的端口连接在哪个子网上，其IP地址就应属于该子网。
例如：路由器A两个端口的IP地址200.4.1.1、200.4.2.53分别属于子网200.4.1.0和子网200.4.2.0。路由器B的两个端口的IP地址200.4.2.34、200.4.3.115分别属于子网200.4.2.0和子网200.4.3.0。



路由器端口IP连接在哪个子网上，其IP就应属于该子网

网关应该是本网络可用IP的第一个或最后一个



每个路由器中有一个路由表，路由表的字段表示能够前往的网络和如何前往那些网络。
路由表的每一行：表示路由器了解的某个网络的信息。
目标网络：本路由器能够前往的网络
端口：    前往某网络该从哪个端口转发
下一跳：  前往某网络，下一跳的中继路由器的IP地址
距离（跳数）：前往某网络需要穿越几个路由器
协议：表示本行路由记录是如何得到的，手工配置or动态学习。
定时：表示动态学习的路由项在路由表中已经多长时间没有刷新。



路由表是路由器工作的基础。路由表中的表项有两种方法获得：
静态配置：将电脑与路由器的console端口连接，使用电脑上的超级终端软件或路由器提供的配置软件就可以对路由器进行配置。
动态学习：每个路由器定时把自己的路由表广播给邻居，邻居之间互相交换路由表。路由器通过其它路由器的路由广播中可以了解更多、更远的网络，这些网络都将被收到自己的路由表中，只要把路由表的下一跳地址指向邻居路由器就可以了。



静态配置路由表的优点：
可以人为地干预网络路径选择。
静态配置路由表的端口没有路由广播，节省带宽和邻居路由器CPU维护路由表的时间。
可以对邻居屏蔽自己的网络情况。
静态配置的缺点：
不能动态发现新的和失效的路由。如果一条路由失效不能及时发现，数据传输就失去了可靠性，同时，无法到达目标主机的数据报不停地发送到网络中，浪费了网络的带宽。
对于一个大型网络来说，人工配置的工作量大也是静态配置的一个问题。



动态学习路由表的优点：
可以动态了解网络的变化。新增、失效的路由都能动态地导致路由表做相应变化。这种自适应特性是使用动态路由的重要原因。
对于大型的网络，无一不采用动态学习的方式维护路由表。
动态学习路由表的缺点：
路由广播会耗费网络带宽。
路由器的CPU也需要停下数据转发工作来处理路由广播，维护路由表，降低了路由器的吞吐量。
注意：
路由器中大部分路由信息是通过动态学习得到的。但是，路由器即使使用动态学习的方法，也需要静态配置直接相连的网段。不然，所有路由器都对外发布空的路由表，互相是无法学习的。
流行的支持路由器动态学习生成路由表的协议是：路由信息协议RIP、内部网关路由协议IGRP、开放的最短路径优先协议OSPF。



使用 ARP 的四种典型情况 ：

发送方是主机，要把 IP 数据报发送到本网络上的另一个主机。这时用 ARP 找到目的主机的硬件地址。 
发送方是主机，要把 IP 数据报发送到另一个网络上的一个主机。这时用 ARP 找到本网络上的一个路由器的硬件地址。剩下的工作由这个路由器来完成。 
发送方是路由器，要把 IP 数据报转发到本网络上的一个主机。这时用 ARP 找到目的主机的硬件地址。 
发送方是路由器，要把 IP 数据报转发到另一个网络上的一个主机。这时用 ARP 找到本网络上另一个路由器的硬件地址。剩下的工作由这个路由器来完成。 